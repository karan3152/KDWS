{% extends "dashboard_layout.html" %}

{% block title %}View Document{% endblock %}

{% block dashboard_title %}{{ document.document_name }}{% endblock %}

{% block additional_css %}
{{ super() }}
<style>
    .document-details {
        margin-bottom: 1.5rem;
    }
    
    .document-property {
        margin-bottom: 0.5rem;
    }
    
    .document-property-label {
        font-weight: 600;
        color: #4A5568;
    }
    
    .document-viewer {
        min-height: 700px;
        background-color: #f7fafc;
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        overflow: hidden;
    }
    
    #pdfViewer {
        width: 100%;
        height: 700px;
        border: none;
    }
    
    .status-badge {
        font-size: 0.85rem;
        padding: 0.4rem 0.8rem;
        border-radius: 9999px;
    }
    
    .document-image {
        max-width: 100%;
        max-height: 700px;
        margin: 0 auto;
        display: block;
        border-radius: 0.5rem;
    }
</style>
{% endblock %}

{% block dashboard_content %}
<div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Document Details</h5>
            </div>
            <div class="card-body">
                <div class="document-details">
                    <div class="document-property">
                        <div class="document-property-label">Type</div>
                        <div>{{ document.document_type|replace('_', ' ')|title }}</div>
                    </div>
                    
                    <div class="document-property">
                        <div class="document-property-label">Uploaded On</div>
                        <div>{{ document.upload_date.strftime('%d %B, %Y') }}</div>
                    </div>
                    
                    <div class="document-property">
                        <div class="document-property-label">Status</div>
                        <div>
                            <span class="status-badge badge {% if document.status == 'pending' %}badge-warning{% elif document.status == 'approved' %}badge-success{% else %}badge-danger{% endif %}">
                                {{ document.status|title }}
                            </span>
                        </div>
                    </div>
                    
                    {% if document.document_number %}
                    <div class="document-property">
                        <div class="document-property-label">Document Number</div>
                        <div>{{ document.document_number }}</div>
                    </div>
                    {% endif %}
                    
                    {% if document.bank_name %}
                    <div class="document-property">
                        <div class="document-property-label">Bank Name</div>
                        <div>{{ document.bank_name }}</div>
                    </div>
                    {% endif %}
                    
                    {% if document.ifsc_code %}
                    <div class="document-property">
                        <div class="document-property-label">IFSC Code</div>
                        <div>{{ document.ifsc_code }}</div>
                    </div>
                    {% endif %}
                    
                    {% if document.issue_date %}
                    <div class="document-property">
                        <div class="document-property-label">Issue Date</div>
                        <div>{{ document.issue_date.strftime('%d %B, %Y') }}</div>
                    </div>
                    {% endif %}
                    
                    {% if document.expiry_date %}
                    <div class="document-property">
                        <div class="document-property-label">Expiry Date</div>
                        <div>{{ document.expiry_date.strftime('%d %B, %Y') }}</div>
                    </div>
                    {% endif %}
                </div>
                
                <a href="javascript:history.back()" class="btn btn-secondary btn-block">
                    <i class="fas fa-arrow-left mr-2"></i> Back
                </a>
                
                {% if current_user.is_admin() or current_user.is_employer() %}
                <div class="mt-3">
                    <button class="btn btn-success btn-block" onclick="approveDocument()">
                        <i class="fas fa-check-circle mr-2"></i> Approve
                    </button>
                    <button class="btn btn-danger btn-block mt-2" onclick="rejectDocument()">
                        <i class="fas fa-times-circle mr-2"></i> Reject
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-9">
        <div class="document-viewer">
            {% if document.file_path.endswith('.pdf') %}
                <iframe id="pdfViewer" src="{{ url_for('static', filename=document.file_path) }}"></iframe>
            {% else %}
                <img class="document-image" src="{{ url_for('static', filename=document.file_path) }}" alt="{{ document.document_name }}">
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block dashboard_js %}
{% if current_user.is_admin() or current_user.is_employer() %}
<script>
    function approveDocument() {
        if (confirm('Are you sure you want to approve this document?')) {
            // Add AJAX call to approve document
            alert('Document approval functionality will be implemented');
        }
    }
    
    function rejectDocument() {
        if (confirm('Are you sure you want to reject this document?')) {
            // Add AJAX call to reject document
            alert('Document rejection functionality will be implemented');
        }
    }
</script>
{% endif %}
{% endblock %}
